// This file was automatically generated by bifcl from /home/benjamin/Bro/bro-2.3.1/src/analyzer/protocol/tcp/functions.bif (plugin mode).


#include "functions.bif.h"


#line 2 "functions.bif"

#include "analyzer/protocol/tcp/TCP.h"

#line 16 "functions.bif"
Val* BifFunc::bro_get_orig_seq(Frame* frame, val_list* BiF_ARGS)
	
#line 17 "functions.bif"
{
	if ( BiF_ARGS->length() != 1 )
		{
		reporter->Error("get_orig_seq() takes exactly 1 argument(s)");
		return 0;
		}
	Val* cid = (Val*) ((*BiF_ARGS)[0]);

#line 17 "functions.bif"

	Connection* c = sessions->FindConnection(cid);
	if ( ! c )
		return new Val(0, TYPE_COUNT);

	if ( c->ConnTransport() != TRANSPORT_TCP )
		return new Val(0, TYPE_COUNT);

	analyzer::Analyzer* tc = c->FindAnalyzer("TCP");
	if ( tc )
		return new Val(static_cast<analyzer::tcp::TCP_Analyzer*>(tc)->OrigSeq(),
				TYPE_COUNT);
	else
		{
		reporter->Error("connection does not have TCP analyzer");
		return new Val(0, TYPE_COUNT);
		}
	} // end of BifFunc::bro_get_orig_seq

#line 34 "functions.bif"

#line 46 "functions.bif"
Val* BifFunc::bro_get_resp_seq(Frame* frame, val_list* BiF_ARGS)
	
#line 47 "functions.bif"
{
	if ( BiF_ARGS->length() != 1 )
		{
		reporter->Error("get_resp_seq() takes exactly 1 argument(s)");
		return 0;
		}
	Val* cid = (Val*) ((*BiF_ARGS)[0]);

#line 47 "functions.bif"

	Connection* c = sessions->FindConnection(cid);
	if ( ! c )
		return new Val(0, TYPE_COUNT);

	if ( c->ConnTransport() != TRANSPORT_TCP )
		return new Val(0, TYPE_COUNT);

	analyzer::Analyzer* tc = c->FindAnalyzer("TCP");
	if ( tc )
		return new Val(static_cast<analyzer::tcp::TCP_Analyzer*>(tc)->RespSeq(),
				TYPE_COUNT);
	else
		{
		reporter->Error("connection does not have TCP analyzer");
		return new Val(0, TYPE_COUNT);
		}
	} // end of BifFunc::bro_get_resp_seq

#line 64 "functions.bif"

#line 75 "functions.bif"
Val* BifFunc::bro_get_gap_summary(Frame* frame, val_list* BiF_ARGS)
	
#line 76 "functions.bif"
{
	if ( BiF_ARGS->length() != 0 )
		{
		reporter->Error("get_gap_summary() takes exactly 0 argument(s)");
		return 0;
		}

#line 76 "functions.bif"

	RecordVal* r = new RecordVal(gap_info);
	r->Assign(0, new Val(tot_ack_events, TYPE_COUNT));
	r->Assign(1, new Val(tot_ack_bytes, TYPE_COUNT));
	r->Assign(2, new Val(tot_gap_events, TYPE_COUNT));
	r->Assign(3, new Val(tot_gap_bytes, TYPE_COUNT));

	return r;
	} // end of BifFunc::bro_get_gap_summary

#line 84 "functions.bif"

#line 117 "functions.bif"
Val* BifFunc::bro_set_contents_file(Frame* frame, val_list* BiF_ARGS)
	
#line 118 "functions.bif"
{
	if ( BiF_ARGS->length() != 3 )
		{
		reporter->Error("set_contents_file() takes exactly 3 argument(s)");
		return 0;
		}
	Val* cid = (Val*) ((*BiF_ARGS)[0]);
	bro_uint_t direction = (bro_uint_t) ((*BiF_ARGS)[1]->AsCount());
	BroFile* f = (BroFile*) ((*BiF_ARGS)[2]->AsFile());

#line 118 "functions.bif"

	Connection* c = sessions->FindConnection(cid);
	if ( ! c )
		return new Val(0, TYPE_BOOL);

	c->GetRootAnalyzer()->SetContentsFile(direction, f);
	return new Val(1, TYPE_BOOL);
	} // end of BifFunc::bro_set_contents_file

#line 125 "functions.bif"

#line 140 "functions.bif"
Val* BifFunc::bro_get_contents_file(Frame* frame, val_list* BiF_ARGS)
	
#line 141 "functions.bif"
{
	if ( BiF_ARGS->length() != 2 )
		{
		reporter->Error("get_contents_file() takes exactly 2 argument(s)");
		return 0;
		}
	Val* cid = (Val*) ((*BiF_ARGS)[0]);
	bro_uint_t direction = (bro_uint_t) ((*BiF_ARGS)[1]->AsCount());

#line 141 "functions.bif"

	Connection* c = sessions->FindConnection(cid);
	BroFile* f = c ? c->GetRootAnalyzer()->GetContentsFile(direction) : 0;

	if ( f )
		{
		Ref(f);
		return new Val(f);
		}

	// Return some sort of error value.
	if ( ! c )
		builtin_error("unknown connection id in get_contents_file()", cid);
	else
		builtin_error("no contents file for given direction");

	return new Val(new BroFile(stderr, "-", "w"));
	} // end of BifFunc::bro_get_contents_file

#line 158 "functions.bif"
